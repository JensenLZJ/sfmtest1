<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Schedule - SamudraFM</title>
    <meta name="description" content="Check out our live radio schedule and upcoming shows on SamudraFM.">
    
    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://samudrafm.com/schedule">
    <meta property="og:title" content="Schedule - SamudraFM">
    <meta property="og:description" content="Check out our live radio schedule and upcoming shows on SamudraFM.">
    <meta property="og:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    <meta property="og:site_name" content="SamudraFM">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://samudrafm.com/schedule">
    <meta property="twitter:title" content="Schedule - SamudraFM">
    <meta property="twitter:description" content="Check out our live radio schedule and upcoming shows on SamudraFM.">
    <meta property="twitter:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <!-- Additional meta tags -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    <meta name="msapplication-TileImage" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com blob: https://widget.mixcloud.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://www.googleapis.com https://api.mixcloud.com https://widget.mixcloud.com; frame-src 'self' https://www.mixcloud.com https://widget.mixcloud.com https://player-widget.mixcloud.com;">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="styles.css?v=1734575000">
    
    <!-- Force schedule layout changes -->
    <style>
        .schedule-item {
            background: #1d283c !important;
            border: none !important;
            border-radius: 10px !important;
            padding: 0 !important;
            display: flex !important;
            align-items: stretch !important;
            gap: 0 !important;
            margin-bottom: 24px !important;
            min-height: auto !important;
            width: 100% !important;
        }
        
        .schedule-image {
            display: none !important;
            padding: 32px !important;
            border-radius: 10px !important;
            border: none !important;
            flex-shrink: 0 !important;
        }
        
        .schedule-image img {
            width: 120px !important;
            height: 120px !important;
            object-fit: cover !important;
            border-radius: 10px !important;
            aspect-ratio: 1 !important;
        }
        
        .schedule-content {
            flex: 1 !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: flex-start !important;
            padding: 16px 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            min-height: 100px !important;
            position: relative !important;
        }
        
             .presenter-name {
                 font-size: 33px !important;
                 font-weight: bold !important;
                 color: white !important;
                 margin: 0 !important;
                 text-overflow: ellipsis !important;
                 overflow: hidden !important;
                 white-space: nowrap !important;
             }
        
        .show-title {
            font-size: 18px !important;
            font-weight: normal !important;
            color: white !important;
            margin: 0 !important;
            line-height: 1.2 !important;
            margin-top: 8px !important;
            display: block !important;
        }
        
        
        .schedule-actions {
            display: flex !important;
            align-items: flex-end !important;
            gap: 10px !important;
            margin-top: auto !important;
            font-size: 18px !important;
            line-height: 0 !important;
            position: absolute !important;
            bottom: 16px !important;
            left: 0 !important;
            right: 0 !important;
        }
        
        .action-btn {
            background: none !important;
            border: none !important;
            color: white !important;
            opacity: 0.25 !important;
            width: 32px !important;
            height: 32px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            pointer-events: none !important;
        }
        
             .schedule-time {
                 background: linear-gradient(135deg, #2a2a3e 0%, #434366 100%) !important;
                 padding: 20px !important;
                 font-weight: 300 !important;
                 color: #ffffff !important;
                 font-size: 18px !important;
                 width: auto !important;
                 margin-left: auto !important;
                 border-radius: 0 10px 10px 0 !important;
                 box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3) !important;
                 min-width: 120px !important;
                 display: flex !important;
                 align-items: center !important;
                 justify-content: center !important;
             }
        
        .time-slot {
            background: none !important;
            color: inherit !important;
            padding: 0 !important;
            border-radius: 0 !important;
            font-size: inherit !important;
            font-weight: inherit !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 8px !important;
            flex-direction: column !important;
            text-align: center !important;
        }
        
        @media (min-width: 1280px) {
            .schedule-image {
                display: flex !important;
            }
            .schedule-content {
                padding: 32px !important;
                padding-left: 0 !important;
            }
            .schedule-actions {
                bottom: 32px !important;
            }
            .schedule-time {
                padding: 40px 60px !important;
                width: 320px !important;
                font-size: 32px !important;
                min-width: 200px !important;
            }
        .time-range {
            font-size: 0.6em !important;
        }
    }
    
    /* Player styling to match schedule items */
    .hero-latest {
        background: #1d283c !important;
        border-radius: 10px !important;
        overflow: hidden !important;
        color: white !important;
        margin: 24px 0 !important;
        padding: 16px !important;
    }
    
    /* Make player cover image smaller on schedule page */
    .hero-latest .player-left {
        flex: 0 0 25% !important;
        max-width: 25% !important;
        aspect-ratio: 1 !important;
    }
    
    .hero-latest .hero-latest-cover {
        width: 100% !important;
        height: 100% !important;
        border-radius: 8px !important;
    }
    
    .hero-latest .play-overlay {
        border-radius: 8px !important;
    }
    
    .hero-latest .player-right {
        flex: 1 !important;
        min-width: 0 !important;
        max-width: 75% !important;
    }
    
    @media (min-width: 1280px) {
        .hero-latest {
            padding: 32px !important;
        }
    }
    
    /* Social Media Button Styles */
    .action-btn {
        background: none !important;
        border: none !important;
        color: white !important;
        opacity: 0.15 !important;
        cursor: not-allowed !important;
        transition: all 0.2s ease !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 32px !important;
        height: 32px !important;
        pointer-events: none !important;
        padding: 0 !important;
        text-decoration: none !important;
    }
    
    .action-btn:hover {
        opacity: 1 !important;
        color: var(--accent, #4a2c8a) !important;
    }
    
    .action-btn.active {
        opacity: 1 !important;
        color: var(--accent, #4a2c8a) !important;
        cursor: pointer !important;
        pointer-events: auto !important;
    }
    
    .action-btn.active:hover {
        color: var(--live, #ff6b6b) !important;
        transform: scale(1.1) !important;
    }
    
    .action-btn.disabled {
        opacity: 0.15 !important;
        cursor: not-allowed !important;
        pointer-events: none !important;
    }
    </style>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/SamudraFMLogo1.png">
    <link rel="apple-touch-icon" href="images/SamudraFMLogo1.png">
    <link rel="shortcut icon" href="images/SamudraFMLogo1.png">
</head>
<body>
    <header class="site-header">
        <div class="container header-inner">
            <a href="/" class="brand" aria-label="SamudraFM Home">
                <span class="brand-mark">Samudra<span>FM</span></span>
                <span class="brand-subtitle">SMK Taman SEA school radio programme</span>
            </a>
            <nav class="nav" aria-label="primary">
                <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">☰</button>
                <ul id="nav-menu" class="nav-list">
                    <li><a href="/">home</a></li>
                    <li><a href="/schedule" class="active">schedule</a></li>
                    <li><a href="/episodes">episodes</a></li>
                    <li><a href="/listen">where to listen</a></li>
                    <li><a href="/about">about</a></li>
                    <li><a href="/contact">contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="site-main">
        <!-- Player Section -->
        <section class="hero" style="display: flex; justify-content: center; align-items: center;">
            <div class="container">
                <div class="panel hero-latest" id="hero-latest" style="width: 100%;">
                <div class="player-widget">
                    <div class="player-left">
                        <div class="hero-latest-cover cover placeholder" id="player-cover"></div>
                        <div class="play-overlay" id="play-overlay">
                            <button class="play-pause-btn" id="hero-play-pause"><i class="fa-solid fa-pause"></i></button>
                        </div>
                    </div>
                    <div class="player-right">
                        <div class="player-info">
                            <h3 id="hero-ep-title" class="track-title">Loading…</h3>
                            <p id="hero-ep-artist" class="track-artist">SamudraFM</p>
                        </div>
                        <div class="player-controls">
                            <div class="volume-control">
                                <span class="volume-icon">🔊</span>
                                <div class="volume-slider">
                                    <div class="volume-bar">
                                        <div class="volume-fill" style="width: 80%"></div>
                                        <div class="volume-handle"></div>
                                    </div>
                                </div>
                            </div>
                            <a id="hero-open" class="request-btn" href="/opportunities" target="_blank" rel="noopener">Join us</a>
                        </div>
                        
                        <!-- Custom Player Controls Only -->
                        <div class="progress-container">
                            <div class="progress" id="progress-bar">
                                <div id="hero-progress" class="bar" style="width:0%"></div>
                                <div class="progress-handle" id="progress-handle"></div>
                            </div>
                            <div class="time-display">
                                <span id="current-time">0:00</span>
                                <span id="total-time">0:00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hero-embed" hidden></div>
                </div>
            </div>
        </section>

        <section class="hero-section" id="schedule">
            <div class="container">
                <div class="hero-content">
                    <h1>Live Radio Schedule</h1>
                    <p>Check out our upcoming shows and live broadcasts</p>
                </div>
            </div>
        </section>

        <!-- Mixcloud Player Container -->
        <div id="mixcloud-player-container" style="position: fixed; bottom: -400px; left: 0; right: 0; height: 400px; background: #1a1a1a; z-index: 1000; transition: bottom 0.3s ease;">
            <div id="mixcloud-player" style="width: 100%; height: 100%;"></div>
        </div>

        <section class="schedule-section">
            <div class="container">
                
                
                <div class="schedule-list" id="schedule-list">
                    <!-- Schedule items will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer" id="about">
        <div class="footer-content">
            <div class="footer-column">
                <div class="footer-logo">
                    <img src="assets/brandmark/SamudraFMLogo1.png" alt="SamudraFM Logo" />
                </div>
                <h2 class="footer-brand-title">SamudraFM</h2>
                <p class="footer-description">
                    Non-Profit Organization. Fully volunteer-run<br>
                    school of SMK Taman SEA radio station.
                </p>
                <p class="footer-programme">
                    Our programme is a recreational school radio initiative, designed to give students hands-on broadcasting experience while exploring creativity in music, events, and radio production.
                </p>
            </div>
            
            <div class="footer-column">
                <h3>Connect & Listen</h3>
                <ul class="footer-links social-links">
                    <li><a href="https://www.instagram.com/samudrafm/" class="social-link"><i class="fab fa-instagram"></i> Instagram</a></li>
                    <li><a href="https://www.facebook.com/SamudraFMSMKTS" class="social-link"><i class="fab fa-facebook"></i> Facebook</a></li>
                    <li><a href="https://www.mixcloud.com/SamudraFM/" class="social-link"><i class="fab fa-mixcloud"></i> Mixcloud</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Legal</h3>
                <ul class="footer-links">
                    <li><a href="privacy-policy.html">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-separator"></div>
        
        <div class="footer-bottom">
            <p>© 2025 SamudraFM. Designed with passion by Jensen Lim Zi Jen 📻</p>
        </div>
    </footer>

    <script>
        // Pagination variables - declare at the top
        let displayedCount = 4; // Show 4 initially
        let loadMoreCount = 2; // Load 2 more each time
        let allScheduleData = []; // Store all data
        let currentDisplayed = 0; // Track how many are currently displayed
        
        // Force cache busting
        function forceCacheBust() {
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            links.forEach(link => {
                const href = link.href;
                if (href.includes('styles.css')) {
                    link.href = href.split('?')[0] + '?v=' + Date.now();
                }
            });
        }
        
        // Initialize schedule page
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Schedule page loaded with pagination support');
                console.log('Pagination variables:', { displayedCount, loadMoreCount, currentDisplayed });
                forceCacheBust();
                
                // Force hard refresh if needed
                if (window.location.search.includes('force=1')) {
                    window.location.reload(true);
                    return;
                }
                
                loadScheduleData();
            } catch (error) {
                console.error('Error initializing schedule page:', error);
            }
        });
        
        // Profile picture mapping is defined in script.js

        // Social media mapping
        const socialMediaLinks = {
            'JensenL': {
                instagram: 'https://www.instagram.com/jensen_lzj/',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            },
            'Jensen': {
                instagram: 'https://www.instagram.com/jensen_lzj/',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            },
            'JensenLim': {
                instagram: 'https://www.instagram.com/jensen_lzj/',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            },
            'Jensen Lim': {
                instagram: 'https://www.instagram.com/jensen_lzj/',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            },
            'Jensen L': {
                instagram: 'https://www.instagram.com/jensen_lzj/',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            }
        };
        
        // Function to get social media links for a presenter
        function getSocialMediaLinks(presenterName) {
            const cleanName = presenterName.trim();
            return socialMediaLinks[cleanName] || {
                instagram: '#',
                twitter: '#',
                facebook: '#',
                youtube: '#'
            };
        }

        // Profile picture functions are defined in script.js
        
        // Load schedule data
        async function loadScheduleData() {
            const scheduleContainer = document.getElementById('schedule-list');
            if (!scheduleContainer) return;
            
            // Show loading state
            scheduleContainer.innerHTML = '<p style="text-align: center; color: var(--muted);">Loading schedule...</p>';
            
            try {
                console.log('Loading schedule data...');
                
                // Try to load from Google Calendar first
                const events = await loadGoogleCalendarEvents();
                console.log('Google Calendar events:', events);
                
                if (events && events.length > 0) {
                    console.log('Using Google Calendar data');
                    console.log('Google Calendar events count:', events.length);
                    allScheduleData = events;
                    renderScheduleItemsPaginated(scheduleContainer);
                    return;
                } else {
                    console.log('No Google Calendar events found, using fallback data');
                }
                
                // Fallback to presenters.json
                const response = await fetch('presenters.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data.events && data.events.length > 0) {
                        // Map the events to the correct format
                        const mappedEvents = data.events.map(event => {
                            const presenter = event.presenter || event.title || 'TBA';
                            return {
                                presenter: presenter,
                                show: event.description || event.show || 'Special Show',
                                startTime: event.startTime || '10:00',
                                endTime: event.endTime || '11:00',
                                image: getProfilePicture(presenter)
                            };
                        });
                        allScheduleData = mappedEvents;
                        renderScheduleItemsPaginated(scheduleContainer);
                        return;
                    }
                }
                
                // Fallback to mock data (images will be auto-detected)
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dayAfter = new Date(today);
                dayAfter.setDate(dayAfter.getDate() + 2);
                
                const mockSchedule = [
                    {
                        presenter: "Marcus",
                        show: "The Dance-floor",
                        startTime: "01:00",
                        endTime: "03:00",
                        date: today.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: today.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "Jess & James",
                        show: "The Odd Show",
                        startTime: "03:00",
                        endTime: "05:00",
                        date: today.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: today.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "JensenL",
                        show: "A Wee Mystical Magical Show",
                        startTime: "06:50",
                        endTime: "07:20",
                        date: tomorrow.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: tomorrow.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "Lana",
                        show: "The Night Shift With Lana",
                        startTime: "05:00",
                        endTime: "07:00",
                        date: tomorrow.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: tomorrow.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "Jessica",
                        show: "Sunday mornings with Jessica!",
                        startTime: "14:00",
                        endTime: "16:00",
                        date: dayAfter.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: dayAfter.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "Niv",
                        show: "Tunes & Coffee!",
                        startTime: "17:00",
                        endTime: "18:00",
                        date: dayAfter.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: dayAfter.toLocaleDateString('en-GB', { weekday: 'long' })
                    },
                    {
                        presenter: "Gavin",
                        show: "Sunday already?!",
                        startTime: "18:00",
                        endTime: "19:00",
                        date: dayAfter.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }),
                        day: dayAfter.toLocaleDateString('en-GB', { weekday: 'long' })
                    }
                ];
                console.log('Using mock data');
                console.log('Mock schedule count:', mockSchedule.length);
                allScheduleData = mockSchedule;
                renderScheduleItemsPaginated(scheduleContainer);
                
            } catch (error) {
                console.error('Error loading schedule:', error);
                scheduleContainer.innerHTML = '<p style="text-align: center; color: var(--muted);">Unable to load schedule. Please try again later.</p>';
            }
        }
        
        // Render schedule items in the new format
        function renderScheduleItems(items, container) {
            if (!items || items.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted);">No schedule available for this date.</p>';
                return;
            }
            
            console.log('Rendering schedule items:', items);
            
            const scheduleHTML = items.map((item, index) => {
                // Ensure all required fields have fallback values
                const presenter = item.presenter || item.title || 'TBA';
                const show = item.show || item.description || 'Special Show';
                const startTime = item.startTime || '10:00';
                const endTime = item.endTime || '11:00';
                
                // Use profile picture detection or fallback to provided image
                const image = item.image || getProfilePicture(presenter);
                
                // Get social media links for this presenter
                const socialLinks = getSocialMediaLinks(presenter);
                
                console.log(`Item ${index}:`, { presenter, show, image, detectedImage: getProfilePicture(presenter) });
                console.log('Show title will be:', show);
                
                return `
                    <div class="schedule-item">
                        <div class="schedule-image">
                            <img src="${image}" alt="${presenter}" onerror="this.src='images/SamudraFMLogo1.png'" />
                        </div>
                        <div class="schedule-content">
                            <div class="presenter-name">${presenter}</div>
                            <div class="show-title">${show}</div>
                 <div class="schedule-actions">
                     <a href="${socialLinks.twitter}" target="_blank" rel="noopener" class="action-btn ${socialLinks.twitter !== '#' ? 'active' : 'disabled'}" title="X (Twitter)">
                         <i class="fab fa-twitter"></i>
                     </a>
                     <a href="${socialLinks.facebook}" target="_blank" rel="noopener" class="action-btn ${socialLinks.facebook !== '#' ? 'active' : 'disabled'}" title="Facebook">
                         <i class="fab fa-facebook"></i>
                     </a>
                     <a href="${socialLinks.instagram}" target="_blank" rel="noopener" class="action-btn ${socialLinks.instagram !== '#' ? 'active' : 'disabled'}" title="Instagram">
                         <i class="fab fa-instagram"></i>
                     </a>
                     <a href="${socialLinks.youtube}" target="_blank" rel="noopener" class="action-btn ${socialLinks.youtube !== '#' ? 'active' : 'disabled'}" title="YouTube">
                         <i class="fab fa-youtube"></i>
                     </a>
                 </div>
                        </div>
                        <div class="schedule-time">
                            <div class="time-slot">
                                <div class="date-day">${item.date || 'Today'}</div>
                                <div class="date-day">${item.day || 'Monday'}</div>
                                <div class="time-range">${startTime} — ${endTime}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = scheduleHTML;
        }
        
        // Render schedule items with pagination
        function renderScheduleItemsPaginated(container) {
            console.log('renderScheduleItemsPaginated called');
            console.log('allScheduleData:', allScheduleData);
            console.log('allScheduleData.length:', allScheduleData ? allScheduleData.length : 'undefined');
            
            if (!allScheduleData || allScheduleData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted);">No schedule available for this date.</p>';
                return;
            }
            
            console.log('Rendering schedule items with pagination:', allScheduleData);
            
            // Reset displayed count
            currentDisplayed = 0;
            
            // Show initial items
            loadMoreItems(container);
        }
        
        // Load more items function
        function loadMoreItems(container) {
            const itemsToShow = allScheduleData.slice(currentDisplayed, currentDisplayed + (currentDisplayed === 0 ? displayedCount : loadMoreCount));
            
            if (itemsToShow.length === 0) {
                return;
            }
            
            console.log('Loading more items:', itemsToShow);
            
            const scheduleHTML = itemsToShow.map((item, index) => {
                // Ensure all required fields have fallback values
                const presenter = item.presenter || item.title || 'TBA';
                const show = item.show || item.description || 'Special Show';
                const startTime = item.startTime || '10:00';
                const endTime = item.endTime || '11:00';
                
                // Use profile picture detection or fallback to provided image
                const image = item.image || getProfilePicture(presenter);
                
                // Get social media links for this presenter
                const socialLinks = getSocialMediaLinks(presenter);
                
                console.log('Show title will be:', show);
                
                return `
                    <div class="schedule-item">
                        <div class="schedule-image">
                            <img src="${image}" alt="${presenter}" onerror="this.src='images/SamudraFMLogo1.png'" />
                        </div>
                        <div class="schedule-content">
                            <div class="presenter-name">${presenter}</div>
                            <div class="show-title">${show}</div>
                 <div class="schedule-actions">
                     <a href="${socialLinks.twitter}" target="_blank" rel="noopener" class="action-btn ${socialLinks.twitter !== '#' ? 'active' : 'disabled'}" title="X (Twitter)">
                         <i class="fab fa-twitter"></i>
                     </a>
                     <a href="${socialLinks.facebook}" target="_blank" rel="noopener" class="action-btn ${socialLinks.facebook !== '#' ? 'active' : 'disabled'}" title="Facebook">
                         <i class="fab fa-facebook"></i>
                     </a>
                     <a href="${socialLinks.instagram}" target="_blank" rel="noopener" class="action-btn ${socialLinks.instagram !== '#' ? 'active' : 'disabled'}" title="Instagram">
                         <i class="fab fa-instagram"></i>
                     </a>
                     <a href="${socialLinks.youtube}" target="_blank" rel="noopener" class="action-btn ${socialLinks.youtube !== '#' ? 'active' : 'disabled'}" title="YouTube">
                         <i class="fab fa-youtube"></i>
                     </a>
                 </div>
                        </div>
                        <div class="schedule-time">
                            <div class="time-slot">
                                <div class="date-day">${item.date || 'Today'}</div>
                                <div class="date-day">${item.day || 'Monday'}</div>
                                <div class="time-range">${startTime} — ${endTime}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (currentDisplayed === 0) {
                // First load - replace content
                container.innerHTML = scheduleHTML;
            } else {
                // Load more - append content
                container.insertAdjacentHTML('beforeend', scheduleHTML);
            }
            
            currentDisplayed += itemsToShow.length;
            
            // Add or update Load More button
            updateLoadMoreButton(container);
        }
        
        // Update Load More button
        function updateLoadMoreButton(container) {
            // Remove existing button
            const existingButton = container.parentNode.querySelector('.load-more-btn');
            if (existingButton) {
                existingButton.remove();
            }
            
            // Check if there are more items to load
            if (currentDisplayed < allScheduleData.length) {
                const loadMoreButton = document.createElement('button');
                loadMoreButton.className = 'load-more-btn';
                loadMoreButton.innerHTML = 'Load More';
                loadMoreButton.style.cssText = `
                    display: block;
                    margin: 20px auto;
                    padding: 12px 24px;
                    background: var(--accent, #4a2c8a);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                
                loadMoreButton.addEventListener('click', () => {
                    loadMoreButton.innerHTML = 'Loading...';
                    loadMoreButton.disabled = true;
                    
                    setTimeout(() => {
                        loadMoreItems(container);
                        loadMoreButton.innerHTML = 'Load More';
                        loadMoreButton.disabled = false;
                    }, 300);
                });
                
                loadMoreButton.addEventListener('mouseenter', () => {
                    loadMoreButton.style.background = 'var(--accent-hover, #5a3a9a)';
                });
                
                loadMoreButton.addEventListener('mouseleave', () => {
                    loadMoreButton.style.background = 'var(--accent, #4a2c8a)';
                });
                
                container.parentNode.appendChild(loadMoreButton);
            }
        }
        
        // Load Google Calendar events via multiple CORS proxies
        async function loadGoogleCalendarEvents() {
            try {
                const apiKey = 'AIzaSyAwJIWjqSccC0lITDPo-qu4Xas3MHkBXX4';
                const calendarId = 'samudrafm.com@gmail.com';
                
                const now = new Date();
                const timeMin = now.toISOString();
                const timeMax = new Date(now.getTime() + (30 * 24 * 60 * 60 * 1000)).toISOString();
                
                const calendarUrl = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&maxResults=50&singleEvents=true&orderBy=startTime`;
                
                // Try multiple CORS proxies for better reliability
                const proxies = [
                    `https://cors-anywhere.herokuapp.com/${calendarUrl}`,
                    `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(calendarUrl)}`,
                    `https://thingproxy.freeboard.io/fetch/${calendarUrl}`
                ];
                
                for (const proxyUrl of proxies) {
                    try {
                        const response = await fetch(proxyUrl, {
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (data.error) {
                                throw new Error(`Google Calendar API error: ${data.error.message}`);
                            }
                            
                            console.log('Total events found in calendar:', data.items ? data.items.length : 0);
                            return data.items.map(event => {
                                const fullTitle = event.summary || 'TBA';
                                
                                // Split "JensenL - A Wee Mystical Magical Show" into presenter and show
                                let presenter, show;
                                if (fullTitle.includes(' - ')) {
                                    const parts = fullTitle.split(' - ');
                                    presenter = parts[0].trim();
                                    show = parts[1].trim();
                                } else {
                                    presenter = fullTitle;
                                    show = event.description || 'Special Show';
                                }
                                
                                const startDate = new Date(event.start?.dateTime || event.start?.date);
                                const endDate = new Date(event.end?.dateTime || event.end?.date);
                                
                                return {
                                    presenter: presenter,
                                    show: show,
                                    startTime: startDate.toLocaleTimeString('en-GB', { 
                                        hour: '2-digit', 
                                        minute: '2-digit',
                                        hour12: false 
                                    }),
                                    endTime: endDate.toLocaleTimeString('en-GB', { 
                                        hour: '2-digit', 
                                        minute: '2-digit',
                                        hour12: false 
                                    }),
                                    date: startDate.toLocaleDateString('en-GB', {
                                        day: 'numeric',
                                        month: 'short'
                                    }),
                                    day: startDate.toLocaleDateString('en-GB', {
                                        weekday: 'long'
                                    }),
                                    image: getProfilePicture(presenter)
                                };
                            });
                        }
                    } catch (proxyError) {
                        console.warn('Proxy failed, trying next:', proxyError.message);
                        continue;
                    }
                }
                
                throw new Error('All CORS proxies failed');
                
            } catch (error) {
                console.error('Google Calendar API error:', error);
                return null;
            }
        }
    </script>
    
    <!-- Mixcloud Widget Script -->
    <script src="https://widget.mixcloud.com/media/js/widgetApi.js" type="text/javascript"></script>
    
    <script src="script.js"></script>
</body>
</html>
