<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send a Song Request - SamudraFM</title>
    <meta name="description" content="Send your song requests to SamudraFM - Your study, your music.">
    
    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://samudrafm.com/request.html">
    <meta property="og:title" content="Send a Song Request - SamudraFM">
    <meta property="og:description" content="Send your song requests to SamudraFM - Your study, your music.">
    <meta property="og:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    <meta property="og:site_name" content="SamudraFM">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://samudrafm.com/request.html">
    <meta property="twitter:title" content="Send a Song Request - SamudraFM">
    <meta property="twitter:description" content="Send your song requests to SamudraFM - Your study, your music.">
    <meta property="twitter:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <!-- Additional meta tags -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    <meta name="msapplication-TileImage" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/SamudraFMLogo1.png">
    <link rel="apple-touch-icon" href="images/SamudraFMLogo1.png">
    <link rel="shortcut icon" href="images/SamudraFMLogo1.png">
</head>
<body>
    <header class="site-header">
        <div class="container header-inner">
            <a href="/" class="brand" aria-label="SamudraFM Home">
                <span class="brand-mark">Samudra<span>FM</span></span>
                <span class="brand-subtitle">SMK Taman SEA school radio programme</span>
            </a>
            <nav class="nav" aria-label="primary">
                <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">â˜°</button>
                <ul id="nav-menu" class="nav-list">
                    <li><a href="/">home</a></li>
                    <li><a href="/#schedule">schedule</a></li>
                    <li><a href="/team">our team</a></li>
                    <li><a href="/#about">about</a></li>
                    <li><a href="/#contact">contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="site-main">
        <!-- Hero Section -->
        <section class="request-hero">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <h1>Request Your Song</h1>
                    <p>Have a song you'd love to hear on SamudraFM? Send us your request and we'll do our best to play it on our next show!</p>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container">
            <div class="request-layout">
                <!-- Form Section -->
                <section class="request-form-section">
                    <div class="form-card">
                        <div class="form-header">
                            <h2><i class="fas fa-paper-plane"></i> Send Your Request</h2>
                            <p>Fill out the form below to request your favorite song</p>
                        </div>
                        
                        <!-- Custom Form UI -->
                        <form id="request-form" class="request-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="song-title">
                                        <i class="fas fa-music"></i>
                                        Song Title *
                                    </label>
                                    <input type="text" id="song-title" name="songTitle" required placeholder="e.g., Bohemian Rhapsody">
                                </div>
                                
                                <div class="form-group">
                                    <label for="artist">
                                        <i class="fas fa-user"></i>
                                        Artist *
                                    </label>
                                    <input type="text" id="artist" name="artist" required placeholder="e.g., Queen">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="your-name">
                                    <i class="fas fa-id-card"></i>
                                    Your Name
                                </label>
                                <input type="text" id="your-name" name="yourName" placeholder="e.g., John Doe">
                            </div>
                            
                            <div class="form-group">
                                <label for="language">
                                    <i class="fas fa-globe"></i>
                                    Language Preference
                                </label>
                                <select id="language" name="language" required>
                                    <option value="">Select language...</option>
                                    <option value="English">English</option>
                                    <option value="Bahasa Malaysia">Bahasa Malaysia</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="message">
                                    <i class="fas fa-comment"></i>
                                    Message (Optional)
                                </label>
                                <textarea id="message" name="message" rows="4" placeholder="Any special message or dedication?"></textarea>
                            </div>
                            
                            <button type="submit" class="btn primary submit-btn" id="submit-btn">
                                <i class="fas fa-paper-plane"></i>
                                <span class="btn-text">Send Request</span>
                                <span class="btn-loading" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Sending...
                                </span>
                            </button>
                        </form>
                        
                        <!-- Hidden Google Form for submission -->
                        <div id="google-form-container" style="display: none;">
                            <iframe 
                                id="google-form-iframe"
                                src="https://docs.google.com/forms/d/e/1FAIpQLSdBW4pG2ARks7itmzN98gscfk7QxHig2S_WLFi6rxJ_ACkwIQ/viewform?embedded=true" 
                                width="100%" 
                                height="600" 
                                frameborder="0" 
                                marginheight="0" 
                                marginwidth="0">
                            </iframe>
                        </div>
                        
                        <div id="success-message" class="success-message" style="display: none;">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3>Request Sent Successfully!</h3>
                            <p>Thank you for your song request! We'll do our best to play it on our next show.</p>
                            <div class="success-actions">
                                <a href="/" class="btn secondary">Back to Home</a>
                                <button onclick="submitAnotherRequest()" class="btn secondary">
                                    <i class="fas fa-plus"></i>
                                    Submit Another Request
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sidebar -->
                <aside class="request-sidebar">
                    <!-- How It Works -->
                    <div class="sidebar-card">
                        <h3><i class="fas fa-cogs"></i> How It Works</h3>
                        <div class="steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>Submit Request</h4>
                                    <p>Fill out the form with your song details</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>We Review</h4>
                                    <p>Our team reviews all requests</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>We Play It</h4>
                                    <p>Selected songs air on our show!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Guidelines -->
                    <div class="sidebar-card">
                        <h3><i class="fas fa-list-check"></i> Guidelines</h3>
                        <ul class="guidelines-list">
                            <li><i class="fas fa-check"></i> Provide accurate song info</li>
                            <li><i class="fas fa-check"></i> English & Malay songs welcome</li>
                            <li><i class="fas fa-check"></i> Keep songs respectful</li>
                            <li><i class="fas fa-check"></i> No guarantee of airplay</li>
                        </ul>
                    </div>

                    <!-- Recent Requests -->
                    <div class="sidebar-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3><i class="fas fa-clock"></i> Recent Requests</h3>
                            <button onclick="loadRecentRequests()" class="refresh-btn" title="Refresh requests">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div id="recent-requests" class="recent-requests">
                            <div class="loading-requests">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading recent requests...</span>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <footer class="site-footer" id="about">
        <div class="footer-content">
            <div class="footer-column">
                <div class="footer-logo">
                    <img src="assets/brandmark/SamudraFMLogo1.png" alt="SamudraFM Logo" />
                </div>
                <h2 class="footer-brand-title">SamudraFM</h2>
                <p class="footer-description">
                    Non-Profit Organization. Fully volunteer-run<br>
                    school of SMK Taman SEA radio station.
                </p>
            </div>
            
            <div class="footer-column">
                <h3>Connect & Listen</h3>
                <ul class="footer-links social-links">
                    <li><a href="https://www.instagram.com/samudrafm/" class="social-link"><i class="fab fa-instagram"></i> Instagram</a></li>
                    <li><a href="https://www.facebook.com/SamudraFMSMKTS" class="social-link"><i class="fab fa-facebook"></i> Facebook</a></li>
                    <li><a href="https://www.mixcloud.com/SamudraFM/" class="social-link"><i class="fab fa-mixcloud"></i> Mixcloud</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Legal</h3>
                <ul class="footer-links">
                    <li><a href="privacy-policy.html">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-separator"></div>
        
        <div class="footer-bottom">
            <p>Â© 2025 SamudraFM. Designed with passion by Jensen Lim Zi Jen ðŸ“»</p>
        </div>
    </footer>

    <script>
        // Configuration - Replace with your actual Google Form and Sheets IDs
        const GOOGLE_FORM_ID = '1FAIpQLSdBW4pG2ARks7itmzN98gscfk7QxHig2S_WLFi6rxJ_ACkwIQ'; // Replace with your Google Form ID
        const GOOGLE_SHEETS_ID = '1U6ap5LrMtgo2a1UDyy2A8niUe2xf9rAov9Ojq4f_EkA'; // Replace with your Google Sheets ID
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyA-iGsaqKLpZAnBx8vOBWnRC4XLCb6vsrQ'; // Replace with your Google Sheets API key or leave as is for demo mode
        
        // Year is now handled in the footer design
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupGoogleForm();
            loadRecentRequests();
            setupMobileNavigation();
        });
        
        // Setup Google Form
        function setupGoogleForm() {
            // Initialize the hidden Google Form iframe
            const iframe = document.getElementById('google-form-iframe');
            if (iframe) {
                iframe.onload = function() {
                    //console.log('Google Form iframe loaded successfully');
                };
                
                iframe.onerror = function() {
                    //console.log('Google Form iframe failed to load');
                };
            }
        }
        
        // Load recent requests from Google Sheets
        async function loadRecentRequests() {
            const container = document.getElementById('recent-requests');
            
            try {
                // If using Google Sheets API
                if (GOOGLE_SHEETS_ID !== 'YOUR_SHEETS_ID' && GOOGLE_SHEETS_API_KEY !== 'YOUR_API_KEY') {
                    //console.log('Loading recent requests from Google Sheets...');
                    
                    // First get the correct sheet name
                    const metadataResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_ID}?key=${GOOGLE_SHEETS_API_KEY}`);
                    const metadata = await metadataResponse.json();
                    
                    if (!metadataResponse.ok) {
                        throw new Error(metadata.error?.message || 'Failed to get sheet metadata');
                    }
                    
                    // Get the first sheet name (usually "Form Responses 1" or similar)
                    const sheetName = metadata.sheets && metadata.sheets[0] ? metadata.sheets[0].properties.title : 'Sheet1';
                    //console.log('Using sheet name:', sheetName);
                    
                    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_ID}/values/${sheetName}!A:F?key=${GOOGLE_SHEETS_API_KEY}`);
                    const data = await response.json();
                    
                    //console.log('Google Sheets response:', data);
                    
                    if (data.values && data.values.length > 1) {
                        // Get the last 5 requests (most recent)
                        const requests = data.values.slice(1).slice(-5).reverse();
                        //console.log('Recent requests from sheet:', requests);
                        displayRecentRequests(requests);
                    } else {
                        //console.log('No data in sheet, showing mock requests');
                        showMockRequests();
                    }
                } else {
                    //console.log('Google Sheets not configured, showing mock requests');
                    showMockRequests();
                }
            } catch (error) {
                //console.error('Error loading recent requests:', error);
                showMockRequests();
            }
        }
        
        // Display recent requests
        function displayRecentRequests(requests) {
            const container = document.getElementById('recent-requests');
            
            if (requests.length === 0) {
                container.innerHTML = '<div class="no-requests">No recent requests yet</div>';
                return;
            }
            
            const html = requests.map(request => {
                // Your Google Sheets format: [Timestamp, Song Title, Artist, Your Name & Class, Language of Song, Special Remarks]
                const [timestamp, songTitle, artist, requesterName, language, specialRemarks] = request;
                const timeAgo = getTimeAgo(new Date(timestamp));
                
                // Skip empty submissions (like the one with just "-" and "Hi")
                if (!songTitle || songTitle === '-' || !artist || artist === 'Hi') {
                    return '';
                }
                
                return `
                    <div class="request-item">
                        <div class="request-info">
                            <strong>${songTitle || 'Unknown Song'}</strong>
                            <span>by ${artist || 'Unknown Artist'}</span>
                            ${requesterName ? `<small>Requested by ${requesterName}</small>` : ''}
                        </div>
                        <div class="request-time">${timeAgo}</div>
                    </div>
                `;
            }).filter(item => item !== '').join(''); // Remove empty items
            
            container.innerHTML = html || '<div class="no-requests">No valid requests found</div>';
        }
        
        // Show mock requests as fallback
        function showMockRequests() {
            const container = document.getElementById('recent-requests');
            const mockRequests = [
                { 
                    song: 'Blinding Lights', 
                    artist: 'The Weeknd', 
                    requester: 'Sarah M. (5A1)',
                    time: '2 hours ago',
                    message: 'Love this song! Perfect for Friday vibes'
                },
                { 
                    song: 'Levitating', 
                    artist: 'Dua Lipa', 
                    requester: 'Alex K. (4B2)',
                    time: '5 hours ago',
                    message: 'Such a bop!'
                },
                { 
                    song: 'Good 4 U', 
                    artist: 'Olivia Rodrigo', 
                    requester: 'Mike R. (6C1)',
                    time: '1 day ago',
                    message: 'This song hits different'
                },
                { 
                    song: 'Stay', 
                    artist: 'The Kid LAROI & Justin Bieber', 
                    requester: 'Emma L. (5A3)',
                    time: '2 days ago',
                    message: 'Can\'t get enough of this!'
                },
                { 
                    song: 'Industry Baby', 
                    artist: 'Lil Nas X ft. Jack Harlow', 
                    requester: 'David C. (4A1)',
                    time: '3 days ago',
                    message: 'Fire track!'
                }
            ];
            
            const html = mockRequests.map(request => `
                <div class="request-item">
                    <div class="request-info">
                        <strong>${request.song}</strong>
                        <span>by ${request.artist}</span>
                        <small>Requested by ${request.requester}</small>
                        ${request.message ? `<div class="request-message">"${request.message}"</div>` : ''}
                    </div>
                    <div class="request-time">${request.time}</div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} days ago`;
            return date.toLocaleDateString();
        }
        
        // Handle form submission to Google Forms
        document.addEventListener('submit', function(e) {
            //console.log('Form submit event triggered:', e.target);
            if (e.target.id === 'request-form') {
                //console.log('Preventing default and calling submitToGoogleForm');
                e.preventDefault();
                submitToGoogleForm(e.target);
            } else {
                //console.log('Form ID does not match:', e.target.id);
            }
        });
        
        // Submit form data to Google Forms
        async function submitToGoogleForm(form) {
            //console.log('submitToGoogleForm called with form:', form);
            
            const submitBtn = document.getElementById('submit-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            //console.log('Submit button elements found:', { submitBtn, btnText, btnLoading });
            
            // Show loading state
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-flex';
            
            //console.log('Loading state applied');
            
            try {
                // Get form data
                const formData = new FormData(form);
                //console.log('FormData entries:');
                for (let [key, value] of formData.entries()) {
                    //console.log(`${key}: ${value}`);
                }
                
                const requestData = {
                    songTitle: formData.get('songTitle'),
                    artist: formData.get('artist'),
                    yourName: formData.get('yourName') || '',
                    language: formData.get('language'),
                    message: formData.get('message') || '',
                    timestamp: new Date().toISOString()
                };
                
                //console.log('Request data object:', requestData);
                
                //console.log('Submitting request:', requestData);
                
                // Submit to Google Forms using FormData
                const success = await submitToGoogleFormsAPI(requestData);
                
                if (success) {
                    // Show success message
                    form.style.display = 'none';
                    document.getElementById('success-message').style.display = 'block';
                    document.getElementById('success-message').scrollIntoView({ behavior: 'smooth' });
                    
                    // Refresh recent requests after a short delay to allow Google Sheets to update
                    setTimeout(() => {
                        loadRecentRequests();
                    }, 2000);
                } else {
                    throw new Error('Failed to submit to Google Forms');
                }
                
            } catch (error) {
                //console.error('Error submitting form:', error);
                showErrorMessage('Failed to submit request. Please try again.');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        }
        
        // Submit to Google Forms using their API
        async function submitToGoogleFormsAPI(data) {
            try {
                // Google Forms submission endpoint
                const formAction = `https://docs.google.com/forms/d/e/${GOOGLE_FORM_ID}/formResponse`;
                
                //console.log('Submitting to:', formAction);
                //console.log('Form data:', data);
                
                // Create form data for Google Forms
                const googleFormData = new FormData();
                
                // Actual entry IDs from your Google Form
                googleFormData.append('entry.567002755', data.songTitle);   // Song Title
                googleFormData.append('entry.1490237756', data.artist);     // Artist
                googleFormData.append('entry.972016159', data.yourName);    // Your Name
                googleFormData.append('entry.966807111', data.language);    // Language Preference
                googleFormData.append('entry.1872415819', data.message);    // Message
                
                //console.log('Google Form data entries:');
                for (let [key, value] of googleFormData.entries()) {
                    //console.log(`${key}: ${value}`);
                }
                
                // Submit using fetch with CORS
                const response = await fetch(formAction, {
                    method: 'POST',
                    mode: 'no-cors', // Google Forms doesn't support CORS
                    body: googleFormData
                });
                
                // Since we can't read the response due to no-cors, we'll assume success
                //console.log('Form submitted to Google Forms (no-cors mode)');
                
                return true;
                
            } catch (error) {
                //console.error('Google Forms submission error:', error);
                return false;
            }
        }
        
        // Show error message
        function showErrorMessage(message) {
            // Create or update error message
            let errorDiv = document.getElementById('error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'error-message';
                document.getElementById('request-form').appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <span>${message}</span>
            `;
            errorDiv.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // Submit another request - reset form and show it again
        function submitAnotherRequest() {
            // Hide success message
            document.getElementById('success-message').style.display = 'none';
            
            // Show form again
            document.getElementById('request-form').style.display = 'block';
            
            // Reset form
            document.getElementById('request-form').reset();
            
            // Scroll to top of form
            document.getElementById('request-form').scrollIntoView({ behavior: 'smooth' });
            
            // Focus on first field
            document.getElementById('song-title').focus();
        }
        
        // Mobile navigation toggle
        function setupMobileNavigation() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('#nav-menu');
            
            navToggle.addEventListener('click', function() {
                const isExpanded = this.getAttribute('aria-expanded') === 'true';
                this.setAttribute('aria-expanded', !isExpanded);
                navMenu.classList.toggle('active');
            });
        }
    </script>
    
</body>
</html>
