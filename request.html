<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4NCN6ZYF05"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4NCN6ZYF05');
    </script>
    
    <title>Send a Song Request - SamudraFM</title>
    <meta name="description" content="Send your song requests to SamudraFM - Your study, your music.">
    
    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://samudrafm.com/request.html">
    <meta property="og:title" content="Send a Song Request - SamudraFM">
    <meta property="og:description" content="Send your song requests to SamudraFM - Your study, your music.">
    <meta property="og:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    <meta property="og:site_name" content="SamudraFM">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://samudrafm.com/request.html">
    <meta property="twitter:title" content="Send a Song Request - SamudraFM">
    <meta property="twitter:description" content="Send your song requests to SamudraFM - Your study, your music.">
    <meta property="twitter:image" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <!-- Additional meta tags -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    <meta name="msapplication-TileImage" content="https://samudrafm.com/images/SamudraFMLogo1.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/SamudraFMLogo1.png">
    <link rel="apple-touch-icon" href="images/SamudraFMLogo1.png">
    <link rel="shortcut icon" href="images/SamudraFMLogo1.png">
    
    <style>
        /* Hero header background for non-home pages */
        .hero-header {
            background-color: rgba(91, 65, 254, 0.5) !important;
        }
        
        /* Player styling to match schedule items */
        .hero-player-section {
            padding: 40px 0 20px 0;
        }
        
        .hero-latest {
            background: #1d283c !important;
            border-radius: 10px !important;
            overflow: hidden !important;
            color: white !important;
            margin: 0 auto !important;
            padding: 20px !important;
            max-width: 100% !important;
            width: 100% !important;
        }
        
        .hero-latest .player-content-row {
            display: flex !important;
            align-items: center !important;
            gap: 20px !important;
        }
        
        .hero-latest .player-left {
            flex: 0 0 80px !important;
            max-width: 80px !important;
            position: relative !important;
        }
        
        .hero-latest .hero-latest-cover {
            width: 80px !important;
            height: 80px !important;
            border-radius: 8px !important;
        }
        
        .hero-latest .play-overlay {
            border-radius: 8px !important;
        }
        
        .hero-latest .player-right {
            flex: 1 !important;
            min-width: 0 !important;
        }
        
        @media (max-width: 768px) {
            .hero-player-section {
                padding: 20px 0 10px 0;
            }
            
            .hero-player-section .container {
                padding-left: 16px !important;
                padding-right: 16px !important;
            }
            
            .hero-latest {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
                min-height: auto !important;
                margin: 24px 0 4px 0 !important;
                padding: 16px !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .hero-latest .player-widget {
                width: 100% !important;
                min-height: 120px !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 12px !important;
                padding: 12px !important;
            }
            
            .hero-latest .player-content-row {
                display: flex !important;
                align-items: center !important;
                gap: 16px !important;
                flex: 1 !important;
            }

            .hero-latest .player-left {
                flex: 0 0 50% !important;
                max-width: 50% !important;
                aspect-ratio: 1 !important;
            }
            
            .hero-latest .player-right {
                flex: 0 0 50% !important;
                max-width: 50% !important;
            }

            .hero-latest .hero-latest-cover {
                width: 100% !important;
                height: 100% !important;
                border-radius: 10px !important;
            }

            .hero-latest .play-overlay {
                pointer-events: auto !important;
                border-radius: 10px !important;
            }

            .hero-latest .play-pause-btn {
                width: 60px !important;
                height: 60px !important;
                font-size: 42px !important;
                background: transparent !important;
                color: white !important;
            }
            
            .hero-latest .player-widget > .progress-container {
                order: 10 !important;
                width: 100% !important;
                margin-top: 8px !important;
            }
            
            .hero-latest .player-right .progress-container {
                display: none !important;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1023px) {
            .hero-player-section {
                padding: 40px 0 20px 0 !important;
            }
            
            .hero-latest {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 12px !important;
                position: relative !important;
                background: rgba(255,255,255,0.1) !important;
                backdrop-filter: blur(20px) !important;
                -webkit-backdrop-filter: blur(20px) !important;
                border-radius: var(--radius) !important;
                padding: 20px !important;
                margin: 20px 0 !important;
                border: 1px solid rgba(255,255,255,0.2) !important;
                box-shadow: 0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1) !important;
                box-sizing: border-box !important;
            }
            
            .hero-latest .player-widget {
                position: relative !important;
                z-index: 10 !important;
                background: rgba(91, 65, 254, 0.3) !important;
                border-radius: var(--radius) !important;
                box-shadow: var(--shadow) !important;
                display: flex !important;
                gap: 16px !important;
                align-items: center !important;
                padding: 16px !important;
                width: 100% !important;
                max-width: none !important;
                max-height: 212px !important;
                box-sizing: border-box !important;
            }
            
            .hero-latest .player-content-row {
                display: flex !important;
                align-items: center !important;
                gap: 20px !important;
                flex: 1 !important;
            }
            
            .hero-latest .player-left {
                position: relative !important;
                flex: 0 0 auto !important;
                width: 180px !important;
                height: 180px !important;
                max-width: 180px !important;
                max-height: 180px !important;
                min-width: 180px !important;
                min-height: 180px !important;
            }
            
            .hero-latest .hero-latest-cover {
                width: 100% !important;
                height: 100% !important;
                border-radius: 12px !important;
                background-size: cover !important;
                background-position: center !important;
                background-repeat: no-repeat !important;
            }
            
            .hero-latest .play-overlay {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: rgba(0,0,0,0.2) !important;
                border-radius: 12px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                opacity: 1 !important;
                transition: opacity 0.2s !important;
                pointer-events: none !important;
            }
            
            .hero-latest .player-right {
                flex: 1 !important;
                min-width: 0 !important;
            }
            
            .hero-latest .player-widget > .progress-container {
                display: none !important;
            }
            
            .hero-latest .player-content-row .player-right .progress-container {
                display: block !important;
            }
        }
        
        @media (min-width: 1024px) {
            .hero-player-section {
                padding: 40px 0 20px 0 !important;
            }
            
            .hero-latest {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 12px !important;
                position: relative !important;
                background: rgba(255,255,255,0.1) !important;
                backdrop-filter: blur(20px) !important;
                -webkit-backdrop-filter: blur(20px) !important;
                border-radius: var(--radius) !important;
                padding: 20px !important;
                margin: 20px 0 !important;
                border: 1px solid rgba(255,255,255,0.2) !important;
                box-shadow: 0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1) !important;
            }
            
            .hero-latest .player-widget {
                position: relative !important;
                z-index: 10 !important;
                background: rgba(91, 65, 254, 0.3) !important;
                border-radius: var(--radius) !important;
                box-shadow: var(--shadow) !important;
                display: flex !important;
                gap: 16px !important;
                align-items: center !important;
                padding: 16px !important;
                width: 100% !important;
                max-width: none !important;
                max-height: 212px !important;
                box-sizing: border-box !important;
            }
            
            .hero-latest .player-content-row {
                display: flex !important;
                align-items: center !important;
                gap: 20px !important;
                flex: 1 !important;
            }
            
            .hero-latest .player-left {
                position: relative !important;
                flex: 0 0 auto !important;
                width: 180px !important;
                height: 180px !important;
                max-width: 180px !important;
                max-height: 180px !important;
                min-width: 180px !important;
                min-height: 180px !important;
            }
            
            .hero-latest .hero-latest-cover {
                width: 100% !important;
                height: 100% !important;
                border-radius: 12px !important;
                background-size: cover !important;
                background-position: center !important;
                background-repeat: no-repeat !important;
            }
            
            .hero-latest .play-overlay {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: rgba(0,0,0,0.2) !important;
                border-radius: 12px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                opacity: 1 !important;
                transition: opacity 0.2s !important;
                pointer-events: none !important;
            }
            
            .hero-latest .player-right {
                flex: 1 !important;
                min-width: 0 !important;
            }
            
            .hero-latest .player-widget > .progress-container {
                display: none !important;
            }
            
            .hero-latest .player-content-row .player-right .progress-container {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <main class="site-main">
        <!-- Hero Section with integrated header -->
        <section class="request-hero">
            <!-- Hero Header -->
            <header class="hero-header">
                <div class="container hero-header-inner">
                    <a href="/" class="brand" aria-label="SamudraFM Home">
                        <span class="brand-mark"><img src="assets/brandmark/samudrafmcomTextLogo1.svg" alt="samudrafm.com" style="height: 1.2em; vertical-align: middle; display: inline-block;"></span>
                        <span class="brand-subtitle">SMK Taman SEA school radio programme</span>
                    </a>
                    <nav class="nav" aria-label="primary">
                        <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                            <span class="hamburger-line"></span>
                        </button>
                        <ul id="nav-menu" class="nav-list">
                            <li><a href="/">home</a></li>
                            <li><a href="/schedule">schedule</a></li>
                            <li><a href="/team">our team</a></li>
                            <li><a href="/about">about</a></li>
                            <li class="nav-dropdown">
                                <a href="/contact">contact</a>
                                <ul class="dropdown-menu">
                                    <li><a href="/contact">feedback</a></li>
                                    <li><a href="/request" class="active">request</a></li>
                                    <li><a href="/opportunities">opportunities</a></li>
                                    <li><a href="/apply">apply</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
            </header>
            <!-- Player Section -->
            <section class="hero-player-section">
                <div class="container">
                    <div class="panel hero-latest" id="hero-latest">
                        <div class="player-widget">
                            <div class="player-content-row">
                                <div class="player-left">
                                    <div class="hero-latest-cover cover placeholder" id="player-cover"></div>
                                    <div class="live-badge">LIVE</div>
                                    <div class="play-overlay" id="play-overlay">
                                        <button class="play-pause-btn" id="hero-play-pause"><i class="fa-solid fa-pause"></i></button>
                                    </div>
                                </div>
                                <div class="player-right">
                                    <div class="player-info">
                                        <h3 id="hero-ep-title" class="track-title">Loadingâ€¦</h3>
                                        <p id="hero-ep-artist" class="track-artist">by <img src="assets/brandmark/samudrafmcomTextLogo1.svg" alt="samudrafm.com" style="height: 1em; vertical-align: middle; display: inline-block; margin: 0 2px;"></p>
                                    </div>
                                    <div class="player-controls">
                                        <div class="volume-control">
                                            <span class="volume-icon">ðŸ”Š</span>
                                            <div class="volume-slider">
                                                <div class="volume-bar">
                                                    <div class="volume-fill" style="width: 80%"></div>
                                                    <div class="volume-handle"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <a id="hero-open" class="request-btn" href="request" target="_blank" rel="noopener">Send a request</a>
                                    </div>
                                    
                                    <!-- Progress Bar for Desktop -->
                                    <div class="progress-container">
                                        <div class="progress" id="progress-bar-desktop">
                                            <div id="hero-progress-desktop" class="bar" style="width:0%"></div>
                                            <div class="progress-handle" id="progress-handle-desktop"></div>
                                        </div>
                                        <div class="time-display">
                                            <span id="current-time-desktop">0:00</span>
                                            <span id="total-time-desktop">0:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Progress Bar - Full Width on Mobile -->
                            <div class="progress-container">
                                <div class="progress" id="progress-bar">
                                    <div id="hero-progress" class="bar" style="width:0%"></div>
                                    <div class="progress-handle" id="progress-handle"></div>
                                </div>
                                <div class="time-display">
                                    <span id="current-time">0:00</span>
                                    <span id="total-time">0:00</span>
                                </div>
                            </div>
                        </div>
                        <div class="hero-embed" hidden></div>
                    </div>
                </div>
            </section>

            <!-- Mixcloud Player Container -->
            <div id="mixcloud-player-container" style="position: fixed; bottom: -400px; left: 0; right: 0; height: 400px; background: #1a1a1a; z-index: 1000; transition: bottom 0.3s ease;">
                <div id="mixcloud-player" style="width: 100%; height: 100%;"></div>
            </div>

            <div class="container">
                <div class="hero-content">
                    <div class="hero-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <h1>Request Your Song</h1>
                    <p>Have a song you'd love to hear on SamudraFM? Send us your request and we'll do our best to play it on our next show!</p>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container">
            <div class="request-layout">
                <!-- Form Section -->
                <section class="request-form-section">
                    <!-- How It Works -->
                    <div class="sidebar-card">
                        <h3><i class="fas fa-cogs"></i> How It Works</h3>
                        <div class="steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>Submit Request</h4>
                                    <p>Fill out the form with your song details</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>We Review</h4>
                                    <p>Our team reviews all requests</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>We Play It</h4>
                                    <p>Selected songs air on our show!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-card">
                        <div class="form-header">
                            <h2><i class="fas fa-paper-plane"></i> Send Your Request</h2>
                            <p>Fill out the form below to request your favorite song</p>
                        </div>
                        
                        <!-- Custom Form UI -->
                        <form id="request-form" class="request-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="song-title">
                                        <i class="fas fa-music"></i>
                                        Song Title *
                                    </label>
                                    <input type="text" id="song-title" name="songTitle" required placeholder="e.g., Bohemian Rhapsody">
                                </div>
                                
                                <div class="form-group">
                                    <label for="artist">
                                        <i class="fas fa-user"></i>
                                        Artist *
                                    </label>
                                    <input type="text" id="artist" name="artist" required placeholder="e.g., Queen">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="your-name">
                                    <i class="fas fa-id-card"></i>
                                    Your Name
                                </label>
                                <input type="text" id="your-name" name="yourName" placeholder="e.g., John Doe">
                            </div>
                            
                            <div class="form-group">
                                <label for="language">
                                    <i class="fas fa-globe"></i>
                                    Language Preference
                                </label>
                                <select id="language" name="language" required>
                                    <option value="">Select language...</option>
                                    <option value="English">English</option>
                                    <option value="Bahasa Malaysia">Bahasa Malaysia</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="message">
                                    <i class="fas fa-comment"></i>
                                    Message (Optional)
                                </label>
                                <textarea id="message" name="message" rows="4" placeholder="Any special message or dedication?"></textarea>
                            </div>
                            
                            <button type="submit" class="btn primary submit-btn" id="submit-btn">
                                <i class="fas fa-paper-plane"></i>
                                <span class="btn-text">Send Request</span>
                                <span class="btn-loading" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Sending...
                                </span>
                            </button>
                        </form>
                        
                        <!-- Hidden Google Form for submission -->
                        <div id="google-form-container" style="display: none;">
                            <iframe 
                                id="google-form-iframe"
                                src="https://docs.google.com/forms/d/e/1FAIpQLSdBW4pG2ARks7itmzN98gscfk7QxHig2S_WLFi6rxJ_ACkwIQ/viewform?embedded=true" 
                                width="100%" 
                                height="600" 
                                frameborder="0" 
                                marginheight="0" 
                                marginwidth="0">
                            </iframe>
                        </div>
                        
                        <div id="success-message" class="success-message" style="display: none;">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3>Request Sent Successfully!</h3>
                            <p>Thank you for your song request! We'll do our best to play it on our next show.</p>
                            <div class="success-actions">
                                <a href="/" class="btn secondary">Back to Home</a>
                                <button onclick="submitAnotherRequest()" class="btn secondary">
                                    <i class="fas fa-plus"></i>
                                    Submit Another Request
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sidebar -->
                <aside class="request-sidebar">
                    <!-- Guidelines -->
                    <div class="sidebar-card">
                        <h3><i class="fas fa-list-check"></i> Guidelines</h3>
                        <ul class="guidelines-list">
                            <li><i class="fas fa-check"></i> Provide accurate song info</li>
                            <li><i class="fas fa-check"></i> English & Malay songs welcome</li>
                            <li><i class="fas fa-check"></i> Keep songs respectful</li>
                            <li><i class="fas fa-check"></i> No guarantee of airplay</li>
                        </ul>
                    </div>

                    <!-- Recent Requests -->
                    <div class="sidebar-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3><i class="fas fa-clock"></i> Recent Requests</h3>
                            <button onclick="loadRecentRequests()" class="refresh-btn" title="Refresh requests">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div id="recent-requests" class="recent-requests">
                            <div class="loading-requests">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading recent requests...</span>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <footer class="site-footer" id="about">
        <div class="footer-content">
            <div class="footer-column">
                <h2 class="footer-brand-title"><img src="assets/brandmark/samudrafmcomTextLogo1.svg" alt="samudrafm.com" style="height: 1.2em; vertical-align: middle; display: inline-block;"></h2>
                <p class="footer-description">
                    Non-Profit Organization. Fully volunteer-run<br>
                    school of SMK Taman SEA radio station.
                </p>
                <p class="footer-programme">
                    Our programme is a recreational school radio initiative, designed to give students hands-on broadcasting experience while exploring creativity in music, events, and radio production.
                </p>
            </div>
            
            <div class="footer-column">
                <h3>Connect & Listen</h3>
                <ul class="footer-links social-links">
                    <li><a href="https://www.instagram.com/samudrafm/" class="social-link"><i class="fab fa-instagram"></i> Instagram</a></li>
                    <li><a href="https://www.facebook.com/SamudraFMSMKTS" class="social-link"><i class="fab fa-facebook"></i> Facebook</a></li>
                    <li><a href="https://www.mixcloud.com/SamudraFM/" class="social-link"><i class="fab fa-mixcloud"></i> Mixcloud</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>Links</h3>
                <ul class="footer-links">
                    <li><a href="about">About Us</a></li>
                    <li><a href="team">Team</a></li>
                    <li><a href="opportunities">Opportunities</a></li>
                    <li><a href="contact">Feedback</a></li>
                    <li><a href="brand">Brand Usage</a></li>
                    <li><a href="privacy-policy">Privacy Policy</a></li>
                </ul>
            </div>
        </div>
        
        
        <div class="footer-bottom">
            <p>Â© 2025 SamudraFM. Designed with passion by Jensen. ðŸ“»</p>
        </div>
    </footer>

    <script>
        // Configuration - Replace with your actual Google Form and Sheets IDs
        const GOOGLE_FORM_ID = '1FAIpQLSdBW4pG2ARks7itmzN98gscfk7QxHig2S_WLFi6rxJ_ACkwIQ'; // Replace with your Google Form ID
        const GOOGLE_SHEETS_ID = '1U6ap5LrMtgo2a1UDyy2A8niUe2xf9rAov9Ojq4f_EkA'; // Replace with your Google Sheets ID
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyA-iGsaqKLpZAnBx8vOBWnRC4XLCb6vsrQ'; // Replace with your Google Sheets API key or leave as is for demo mode
        
        // Year is now handled in the footer design
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupGoogleForm();
            loadRecentRequests();
            setupMobileNavigation();
        });
        
        // Setup Google Form
        function setupGoogleForm() {
            // Initialize the hidden Google Form iframe
            const iframe = document.getElementById('google-form-iframe');
            if (iframe) {
                iframe.onload = function() {
                    //console.log('Google Form iframe loaded successfully');
                };
                
                iframe.onerror = function() {
                    //console.log('Google Form iframe failed to load');
                };
            }
        }
        
        // Load recent requests from Google Sheets
        async function loadRecentRequests() {
            const container = document.getElementById('recent-requests');
            const refreshBtn = document.querySelector('.refresh-btn');
            
            // Add spinning animation
            const animationStartTime = Date.now();
            if (refreshBtn) {
                refreshBtn.classList.add('spinning');
            }
            
            try {
                // If using Google Sheets API
                if (GOOGLE_SHEETS_ID !== 'YOUR_SHEETS_ID' && GOOGLE_SHEETS_API_KEY !== 'YOUR_API_KEY') {
                    //console.log('Loading recent requests from Google Sheets...');
                    
                    // First get the correct sheet name
                    const metadataResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_ID}?key=${GOOGLE_SHEETS_API_KEY}`);
                    const metadata = await metadataResponse.json();
                    
                    if (!metadataResponse.ok) {
                        throw new Error(metadata.error?.message || 'Failed to get sheet metadata');
                    }
                    
                    // Get the first sheet name (usually "Form Responses 1" or similar)
                    const sheetName = metadata.sheets && metadata.sheets[0] ? metadata.sheets[0].properties.title : 'Sheet1';
                    //console.log('Using sheet name:', sheetName);
                    
                    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_ID}/values/${sheetName}!A:F?key=${GOOGLE_SHEETS_API_KEY}`);
                    const data = await response.json();
                    
                    //console.log('Google Sheets response:', data);
                    
                    if (data.values && data.values.length > 1) {
                        // Get the last 5 requests (most recent)
                        const requests = data.values.slice(1).slice(-5).reverse();
                        //console.log('Recent requests from sheet:', requests);
                        displayRecentRequests(requests);
                    } else {
                        //console.log('No data in sheet, showing mock requests');
                        showMockRequests();
                    }
                } else {
                    //console.log('Google Sheets not configured, showing mock requests');
                    showMockRequests();
                }
            } catch (error) {
                //console.error('Error loading recent requests:', error);
                showMockRequests();
            } finally {
                // Remove spinning animation after minimum duration (600ms) or immediately if longer
                if (refreshBtn) {
                    const elapsed = Date.now() - animationStartTime;
                    const minDuration = 600;
                    const remaining = Math.max(0, minDuration - elapsed);
                    setTimeout(() => {
                        refreshBtn.classList.remove('spinning');
                    }, remaining);
                }
            }
        }
        
        // Display recent requests
        function displayRecentRequests(requests) {
            const container = document.getElementById('recent-requests');
            
            if (requests.length === 0) {
                container.innerHTML = '<div class="no-requests">No recent requests yet</div>';
                return;
            }
            
            const html = requests.map(request => {
                // Your Google Sheets format: [Timestamp, Song Title, Artist, Your Name & Class, Language of Song, Special Remarks]
                const [timestamp, songTitle, artist, requesterName, language, specialRemarks] = request;
                const timeAgo = getTimeAgo(new Date(timestamp));
                
                // Skip empty submissions (like the one with just "-" and "Hi")
                if (!songTitle || songTitle === '-' || !artist || artist === 'Hi') {
                    return '';
                }
                
                return `
                    <div class="request-item">
                        <div class="request-info">
                            <strong>${songTitle || 'Unknown Song'}</strong>
                            <span>by ${artist || 'Unknown Artist'}</span>
                            ${requesterName ? `<small>Requested by ${requesterName}</small>` : ''}
                        </div>
                        <div class="request-time">${timeAgo}</div>
                    </div>
                `;
            }).filter(item => item !== '').join(''); // Remove empty items
            
            container.innerHTML = html || '<div class="no-requests">No valid requests found</div>';
        }
        
        // Show mock requests as fallback
        function showMockRequests() {
            const container = document.getElementById('recent-requests');
            const mockRequests = [
                { 
                    song: 'Blinding Lights', 
                    artist: 'The Weeknd', 
                    requester: 'Sarah M. (5A1)',
                    time: '2 hours ago',
                    message: 'Love this song! Perfect for Friday vibes'
                },
                { 
                    song: 'Levitating', 
                    artist: 'Dua Lipa', 
                    requester: 'Alex K. (4B2)',
                    time: '5 hours ago',
                    message: 'Such a bop!'
                },
                { 
                    song: 'Good 4 U', 
                    artist: 'Olivia Rodrigo', 
                    requester: 'Mike R. (6C1)',
                    time: '1 day ago',
                    message: 'This song hits different'
                },
                { 
                    song: 'Stay', 
                    artist: 'The Kid LAROI & Justin Bieber', 
                    requester: 'Emma L. (5A3)',
                    time: '2 days ago',
                    message: 'Can\'t get enough of this!'
                },
                { 
                    song: 'Industry Baby', 
                    artist: 'Lil Nas X ft. Jack Harlow', 
                    requester: 'David C. (4A1)',
                    time: '3 days ago',
                    message: 'Fire track!'
                }
            ];
            
            const html = mockRequests.map(request => `
                <div class="request-item">
                    <div class="request-info">
                        <strong>${request.song}</strong>
                        <span>by ${request.artist}</span>
                        <small>Requested by ${request.requester}</small>
                        ${request.message ? `<div class="request-message">"${request.message}"</div>` : ''}
                    </div>
                    <div class="request-time">${request.time}</div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} days ago`;
            return date.toLocaleDateString();
        }
        
        // Handle form submission to Google Forms
        document.addEventListener('submit', function(e) {
            //console.log('Form submit event triggered:', e.target);
            if (e.target.id === 'request-form') {
                //console.log('Preventing default and calling submitToGoogleForm');
                e.preventDefault();
                submitToGoogleForm(e.target);
            } else {
                //console.log('Form ID does not match:', e.target.id);
            }
        });
        
        // Submit form data to Google Forms
        async function submitToGoogleForm(form) {
            //console.log('submitToGoogleForm called with form:', form);
            
            const submitBtn = document.getElementById('submit-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoading = submitBtn.querySelector('.btn-loading');
            
            //console.log('Submit button elements found:', { submitBtn, btnText, btnLoading });
            
            // Show loading state
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline-flex';
            
            //console.log('Loading state applied');
            
            try {
                // Get form data
                const formData = new FormData(form);
                //console.log('FormData entries:');
                for (let [key, value] of formData.entries()) {
                    //console.log(`${key}: ${value}`);
                }
                
                const requestData = {
                    songTitle: formData.get('songTitle'),
                    artist: formData.get('artist'),
                    yourName: formData.get('yourName') || '',
                    language: formData.get('language'),
                    message: formData.get('message') || '',
                    timestamp: new Date().toISOString()
                };
                
                //console.log('Request data object:', requestData);
                
                //console.log('Submitting request:', requestData);
                
                // Submit to Google Forms using FormData
                const success = await submitToGoogleFormsAPI(requestData);
                
                if (success) {
                    // Show success message
                    form.style.display = 'none';
                    document.getElementById('success-message').style.display = 'block';
                    document.getElementById('success-message').scrollIntoView({ behavior: 'smooth' });
                    
                    // Refresh recent requests after a short delay to allow Google Sheets to update
                    setTimeout(() => {
                        loadRecentRequests();
                    }, 2000);
                } else {
                    throw new Error('Failed to submit to Google Forms');
                }
                
            } catch (error) {
                //console.error('Error submitting form:', error);
                showErrorMessage('Failed to submit request. Please try again.');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        }
        
        // Submit to Google Forms using their API
        async function submitToGoogleFormsAPI(data) {
            try {
                // Google Forms submission endpoint
                const formAction = `https://docs.google.com/forms/d/e/${GOOGLE_FORM_ID}/formResponse`;
                
                //console.log('Submitting to:', formAction);
                //console.log('Form data:', data);
                
                // Create form data for Google Forms
                const googleFormData = new FormData();
                
                // Actual entry IDs from your Google Form
                googleFormData.append('entry.567002755', data.songTitle);   // Song Title
                googleFormData.append('entry.1490237756', data.artist);     // Artist
                googleFormData.append('entry.972016159', data.yourName);    // Your Name
                googleFormData.append('entry.966807111', data.language);    // Language Preference
                googleFormData.append('entry.1872415819', data.message);    // Message
                
                //console.log('Google Form data entries:');
                for (let [key, value] of googleFormData.entries()) {
                    //console.log(`${key}: ${value}`);
                }
                
                // Submit using fetch with CORS
                const response = await fetch(formAction, {
                    method: 'POST',
                    mode: 'no-cors', // Google Forms doesn't support CORS
                    body: googleFormData
                });
                
                // Since we can't read the response due to no-cors, we'll assume success
                //console.log('Form submitted to Google Forms (no-cors mode)');
                
                return true;
                
            } catch (error) {
                //console.error('Google Forms submission error:', error);
                return false;
            }
        }
        
        // Show error message
        function showErrorMessage(message) {
            // Create or update error message
            let errorDiv = document.getElementById('error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'error-message';
                document.getElementById('request-form').appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <span>${message}</span>
            `;
            errorDiv.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // Submit another request - reset form and show it again
        function submitAnotherRequest() {
            // Hide success message
            document.getElementById('success-message').style.display = 'none';
            
            // Show form again
            document.getElementById('request-form').style.display = 'block';
            
            // Reset form
            document.getElementById('request-form').reset();
            
            // Scroll to top of form
            document.getElementById('request-form').scrollIntoView({ behavior: 'smooth' });
            
            // Focus on first field
            document.getElementById('song-title').focus();
        }
        
        // Mobile navigation toggle
        function setupMobileNavigation() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    const open = navMenu.classList.toggle('open');
                    navToggle.setAttribute('aria-expanded', String(open));
                });
            }
        }
    </script>
    
    <!-- Mixcloud Widget Script -->
    <script src="https://widget.mixcloud.com/media/js/widgetApi.js" type="text/javascript"></script>
    
    <script src="script.js"></script>
    
</body>
</html>
