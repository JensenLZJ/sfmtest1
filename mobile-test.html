<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Play Button Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #007bff;
            margin-bottom: 30px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px;
            transition: all 0.3s;
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
        #debug-output {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74d3ff, #82ffd8);
            color: #001421;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mobile Play Button Test</h1>
        <p>This page tests the mobile play button functionality.</p>
        
        <div class="play-button" id="hero-play-pause" onclick="testMobilePlay()">
            <span class="play-icon">▶</span>
        </div>
        
        <!-- Hidden elements that loadHeroLatest needs -->
        <div style="display: none;">
            <h3 id="hero-ep-title">Loading…</h3>
            <a id="hero-open" href="#">Play on Mixcloud</a>
            <div class="hero-latest-cover cover placeholder" id="player-cover"></div>
        </div>
        
        <!-- Hidden episodes grid for testing -->
        <div id="episodes-grid" style="display: none;"></div>
        
        <!-- Hidden Mixcloud player container for testing -->
        <div id="mixcloud-player-container" style="position: fixed; bottom: -400px; left: 0; width: 100%; height: 400px; opacity: 0; pointer-events: none; z-index: -1; overflow: hidden; transition: bottom 0.3s ease;">
            <div id="mixcloud-player" style="width: 100%; height: 100%; border: none; background: transparent;"></div>
        </div>
        
        <button onclick="testMobilePlay()">Test Mobile Play Function</button>
        <button onclick="testButtonClick()">Test Button Click</button>
        <button onclick="testPlayOnly()">Test Play Only</button>
        <button onclick="testPauseOnly()">Test Pause Only</button>
        <button onclick="testWidgetCreation()">Test Widget Creation</button>
        <button onclick="testMobilePlayer()">Test Mobile Player Direct</button>
        <button onclick="testDirectPlay()">Test Direct Play</button>
        <button onclick="testMixcloudWidget()">Test Mixcloud Widget</button>
        <button onclick="clearDebug()">Clear Debug</button>
        
        <div id="debug-output">
            <h3>Console Output:</h3>
            <pre id="console-log"></pre>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://widget.mixcloud.com/media/js/widgetApi.js"></script>
    <script>
        // Redirect console.log to display on page
        const originalConsoleLog = console.log;
        const consoleLogEl = document.getElementById('console-log');
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            consoleLogEl.textContent += args.join(' ') + '\n';
            consoleLogEl.scrollTop = consoleLogEl.scrollHeight;
        };

        function clearDebug() {
            consoleLogEl.textContent = '';
        }

        // Add missing test functions
        window.testMobilePlay = function() {
            console.log('Testing mobile play function...');
            const playPauseBtn = document.getElementById('hero-play-pause');
            if (playPauseBtn) {
                console.log('Play button found, triggering click...');
                console.log('Play button element:', playPauseBtn);
                console.log('Play button onclick:', playPauseBtn.onclick);
                console.log('Play button event listeners:', playPauseBtn.addEventListener ? 'has addEventListener' : 'no addEventListener');
                
                // Try multiple ways to trigger the button
                playPauseBtn.click();
                
                // Also try direct function call if available
                if (typeof handlePlayPause === 'function') {
                    console.log('Calling handlePlayPause directly...');
                    handlePlayPause();
                } else {
                    console.log('handlePlayPause function not available');
                }
            } else {
                console.log('Play button not found!');
            }
        };

        window.testButtonClick = function() {
            console.log('Testing button click...');
            const playPauseBtn = document.getElementById('hero-play-pause');
            if (playPauseBtn) {
                console.log('Play button found, checking current state...');
                
                // Check current playing state
                const isCurrentlyPlaying = window.isCurrentlyPlaying || false;
                console.log('Current playing state:', isCurrentlyPlaying);
                
                if (isCurrentlyPlaying) {
                    console.log('Currently playing, testing pause functionality...');
                } else {
                    console.log('Currently paused, testing play functionality...');
                }
                
                // Try direct click
                console.log('Triggering direct click...');
                playPauseBtn.click();
                
            } else {
                console.log('Play button not found!');
            }
        };

        // Add function to test play only (force play)
        window.testPlayOnly = function() {
            console.log('Testing play only...');
            
            // Force play state
            if (window.handlePlayPause) {
                // Set playing state to false first to ensure play
                window.isCurrentlyPlaying = false;
                console.log('Set playing state to false, calling handlePlayPause...');
                window.handlePlayPause();
            } else {
                console.log('handlePlayPause function not available');
            }
        };

        // Add function to test pause only (force pause)
        window.testPauseOnly = function() {
            console.log('Testing pause only...');
            
            // Force pause state
            if (window.handlePlayPause) {
                // Set playing state to true first to ensure pause
                window.isCurrentlyPlaying = true;
                console.log('Set playing state to true, calling handlePlayPause...');
                window.handlePlayPause();
            } else {
                console.log('handlePlayPause function not available');
            }
        };

        // Add function to test widget creation
        window.testWidgetCreation = function() {
            console.log('Testing widget creation...');
            console.log('Current episode:', window.currentEpisode);
            
            if (window.currentEpisode && window.currentEpisode.url !== '#') {
                console.log('Creating widget for episode:', window.currentEpisode.url);
                
                // Create a test iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.mixcloud.com/widget/iframe/?hide_cover=1&light=0&autoplay=1&feed=${encodeURIComponent(window.currentEpisode.url)}`;
                iframe.width = '100%';
                iframe.height = '120';
                iframe.frameBorder = '0';
                iframe.allow = 'encrypted-media; fullscreen; autoplay;';
                
                // Add to page temporarily
                const container = document.createElement('div');
                container.style.position = 'fixed';
                container.style.top = '10px';
                container.style.left = '10px';
                container.style.width = '300px';
                container.style.height = '120px';
                container.style.border = '2px solid red';
                container.style.zIndex = '9999';
                container.style.background = 'white';
                container.appendChild(iframe);
                document.body.appendChild(container);
                
                console.log('Test widget created, check if audio plays...');
                
                // Test widget initialization
                iframe.onload = () => {
                    console.log('Test iframe loaded');
                    if (window.Mixcloud) {
                        try {
                            const widget = window.Mixcloud.PlayerWidget(iframe);
                            console.log('Test widget initialized:', widget);
                        } catch (error) {
                            console.error('Error initializing test widget:', error);
                        }
                    } else {
                        console.error('Mixcloud API not available');
                    }
                };
                
                // Remove after 15 seconds
                setTimeout(() => {
                    document.body.removeChild(container);
                    console.log('Test widget removed');
                }, 15000);
                
            } else {
                console.error('No valid episode available for widget test');
            }
        };
        
        // Add function to test mobile player directly
        window.testMobilePlayer = function() {
            console.log('Testing mobile player directly...');
            
            // Check if main script functions are available
            console.log('Available functions:', {
                playEpisode: typeof playEpisode,
                handlePlayPause: typeof handlePlayPause,
                currentEpisode: window.currentEpisode,
                isCurrentlyPlaying: window.isCurrentlyPlaying,
                currentWidget: window.currentWidget
            });
            
            // Check if the play button has event listeners
            const playPauseBtn = document.getElementById('hero-play-pause');
            if (playPauseBtn) {
                console.log('Play button state:', {
                    element: playPauseBtn,
                    onclick: playPauseBtn.onclick,
                    hasEventListeners: playPauseBtn.addEventListener ? 'yes' : 'no'
                });
            }
            
            if (typeof playEpisode === 'function') {
                if (window.currentEpisode) {
                    console.log('Calling playEpisode with:', window.currentEpisode);
                    playEpisode(window.currentEpisode);
                } else {
                    console.error('No current episode available');
                }
            } else {
                console.error('playEpisode function not found');
            }
        };

        // Add function to test direct play without button clicks
        window.testDirectPlay = function() {
            console.log('Testing direct play...');
            
            // Check if we have a current episode
            if (window.currentEpisode) {
                console.log('Current episode available:', window.currentEpisode);
                
                // Try to call playEpisode directly
                if (typeof playEpisode === 'function') {
                    console.log('Calling playEpisode directly...');
                    playEpisode(window.currentEpisode);
                } else {
                    console.log('playEpisode function not available');
                }
                
                // Also try to call handlePlayPause if available
                if (typeof handlePlayPause === 'function') {
                    console.log('Calling handlePlayPause directly...');
                    handlePlayPause();
                } else {
                    console.log('handlePlayPause function not available');
                }
            } else {
                console.log('No current episode available');
                
                // Try to get episode from episodes grid
                const episodesGrid = document.getElementById('episodes-grid');
                if (episodesGrid) {
                    const firstEpisodeCard = episodesGrid.querySelector('.episodes-card');
                    if (firstEpisodeCard) {
                        const episodeTitle = firstEpisodeCard.querySelector('.title')?.textContent;
                        const episodeLink = firstEpisodeCard.querySelector('.play-link')?.href;
                        if (episodeTitle && episodeLink) {
                            const testEpisode = {
                                name: episodeTitle,
                                url: episodeLink
                            };
                            console.log('Created test episode from grid:', testEpisode);
                            
                            if (typeof playEpisode === 'function') {
                                console.log('Calling playEpisode with test episode...');
                                playEpisode(testEpisode);
                            }
                        }
                    }
                }
            }
        };

        // Add function to test Mixcloud widget creation
        window.testMixcloudWidget = function() {
            console.log('Testing Mixcloud widget creation...');
            
            // Check if containers exist
            const playerContainer = document.getElementById('mixcloud-player');
            const container = document.getElementById('mixcloud-player-container');
            
            console.log('Player containers:', {
                playerContainer: !!playerContainer,
                container: !!container,
                playerContainerHTML: playerContainer ? playerContainer.innerHTML : 'not found',
                containerStyle: container ? container.style.bottom : 'not found'
            });
            
            // Check if Mixcloud API is loaded
            console.log('Mixcloud API:', {
                available: !!window.Mixcloud,
                PlayerWidget: typeof window.Mixcloud?.PlayerWidget
            });
            
            // Check for existing iframe
            const existingIframe = document.getElementById('mixcloud-iframe');
            console.log('Existing iframe:', {
                found: !!existingIframe,
                src: existingIframe ? existingIframe.src : 'none',
                loaded: existingIframe ? existingIframe.complete : 'none'
            });
            
            // Try to create a test iframe
            if (playerContainer) {
                console.log('Creating test iframe...');
                const testIframe = document.createElement('iframe');
                testIframe.src = 'https://www.mixcloud.com/widget/iframe/?hide_cover=1&light=0&autoplay=0&feed=' + encodeURIComponent('https://www.mixcloud.com/SamudraFM/tasty-tuesday-show-27-june-2023/');
                testIframe.width = '100%';
                testIframe.height = '120';
                testIframe.frameBorder = '0';
                testIframe.allow = 'encrypted-media; fullscreen; autoplay;';
                testIframe.id = 'test-mixcloud-iframe';
                testIframe.style.border = '2px solid red';
                testIframe.style.position = 'fixed';
                testIframe.style.top = '10px';
                testIframe.style.right = '10px';
                testIframe.style.width = '300px';
                testIframe.style.height = '120px';
                testIframe.style.zIndex = '9999';
                
                document.body.appendChild(testIframe);
                
                testIframe.onload = () => {
                    console.log('Test iframe loaded successfully!');
                    console.log('Iframe src:', testIframe.src);
                    
                    // Try to initialize widget
                    if (window.Mixcloud) {
                        try {
                            const widget = window.Mixcloud.PlayerWidget(testIframe);
                            console.log('Test widget created:', widget);
                        } catch (error) {
                            console.error('Error creating test widget:', error);
                        }
                    }
                };
                
                testIframe.onerror = (error) => {
                    console.error('Test iframe failed to load:', error);
                };
                
                // Remove after 10 seconds
                setTimeout(() => {
                    if (document.body.contains(testIframe)) {
                        document.body.removeChild(testIframe);
                        console.log('Test iframe removed');
                    }
                }, 10000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Mobile test page loaded.');
            console.log('Window width:', window.innerWidth);
            console.log('User agent:', navigator.userAgent);
            console.log('Is mobile (width):', window.innerWidth <= 768);
            console.log('Is mobile (user agent):', /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            console.log('Touch support:', 'ontouchstart' in window);
            
            // Load episodes for testing
            setTimeout(() => {
                if (typeof loadMixcloudEpisodes === 'function') {
                    console.log('Loading episodes for testing...');
                    loadMixcloudEpisodes('samudrafm');
                } else {
                    console.log('loadMixcloudEpisodes function not available');
                }
            }, 1000);
            
            // Check if Mixcloud API loads
            setTimeout(() => {
                console.log('Checking Mixcloud API after 2 seconds...');
                console.log('Mixcloud API available:', !!window.Mixcloud);
                if (window.Mixcloud) {
                    console.log('Mixcloud API loaded successfully!');
                } else {
                    console.log('Mixcloud API not loaded - this will prevent widget controls from working');
                }
            }, 2000);
            
            // Initialize mobile player
            if (typeof initMobilePlayer === 'function') {
                console.log('Calling initMobilePlayer...');
                initMobilePlayer();
            } else {
                console.error('initMobilePlayer function not found');
            }
            
            // Test if functions are available
            if (typeof window.testMobilePlay === 'function') {
                console.log('window.testMobilePlay is available.');
            } else {
                console.error('window.testMobilePlay is NOT available.');
            }
            
            if (typeof window.testButtonClick === 'function') {
                console.log('window.testButtonClick is available.');
            } else {
                console.error('window.testButtonClick is NOT available.');
            }
        });
    </script>
</body>
</html>
